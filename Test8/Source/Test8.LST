C51 COMPILER V9.01   TEST8                                                                 12/06/2018 16:35:05 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TEST8
OBJECT MODULE PLACED IN Test8.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE Test8.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg51.h>    //°üº¬µ¥Æ¬»ú¼Ä´æÆ÷µÄÍ·ÎÄ¼þ
   2          #include<intrins.h>  //°üº¬_nop_()º¯Êý¶¨ÒåµÄÍ·ÎÄ¼þ
   3          
   4          //1602¶Ë¿Ú¶¨Òå
   5          sbit RS=P2^0;    //¼Ä´æÆ÷Ñ¡ÔñÎ»£¬½«RSÎ»¶¨ÒåÎªP2.0Òý½Å
   6          sbit RW=P2^1;    //¶ÁÐ´Ñ¡ÔñÎ»£¬½«RWÎ»¶¨ÒåÎªP2.1Òý½Å
   7          sbit E=P2^2;     //Ê¹ÄÜÐÅºÅÎ»£¬½«EÎ»¶¨ÒåÎªP2.2Òý½Å
   8          sbit BF=P1^7;    //Ã¦Âµ±êÖ¾Î»£¬£¬½«BFÎ»¶¨ÒåÎªP0.7Òý½Å
   9          
  10          //AD¶Ë¿Ú¶¨Òå
  11          sbit CLK=P2^3;
  12          sbit start=P2^4;
  13          sbit oe=P2^5;
  14          sbit eoc=P2^7;
  15          sbit out_pulse=P2^6;//5usÂö³å
  16          sbit p30=P3^0;
  17          
  18          #define uchar unsigned char
  19          #define uint unsigned int
  20          
  21          uchar n=0;
  22          uchar flag=0;//1s±êÖ¾Î»
  23          
  24          
  25          //ÑÓÊ±1ms
  26          void delay1ms()
  27          {
  28   1                      unsigned char i,j;      
  29   1                      for(i=0;i<10;i++)
  30   1                      for(j=0;j<33;j++)
  31   1                 ;             
  32   1       }
  33          
  34          //ÑÓÊ±Èô¸ÉºÁÃë
  35           void delay(unsigned int n)
  36           {
  37   1              unsigned int i;
  38   1              for(i=0;i<n;i++)
  39   1              delay1ms();
  40   1       }
  41          
  42          //ÅÐ¶ÏÒº¾§Ä£¿éµÄÃ¦Âµ×´Ì¬ (1-Ã¦Âµ 0-²»Ã¦)
  43           bit BusyTest(void)
  44            {
  45   1              bit result;
  46   1                      RS=0;       //¸ù¾Ý¹æ¶¨£¬RSÎªµÍµçÆ½£¬RWÎª¸ßµçÆ½Ê±£¬¿ÉÒÔ¶Á×´Ì¬
  47   1              RW=1;
  48   1              E=1;        //E=1£¬²ÅÔÊÐí¶ÁÐ´
  49   1              _nop_();   //¿Õ²Ù×÷
  50   1              _nop_();
  51   1              _nop_(); 
  52   1                      _nop_();   //¿Õ²Ù×÷ËÄ¸ö»úÆ÷ÖÜÆÚ£¬¸øÓ²¼þ·´Ó¦Ê±¼ä 
  53   1              result=BF;  //½«Ã¦Âµ±êÖ¾µçÆ½¸³¸øresult
  54   1                      E=0;
  55   1              return result;
C51 COMPILER V9.01   TEST8                                                                 12/06/2018 16:35:05 PAGE 2   

  56   1        }
  57          
  58          //½«Ä£Ê½ÉèÖÃÖ¸Áî»òÏÔÊ¾µØÖ·Ð´ÈëÒº¾§Ä£¿é
  59          void Write_com (unsigned char dictate)
  60          {   
  61   1          while(BusyTest()==1); //Èç¹ûÃ¦¾ÍµÈ´ý
  62   1               RS=0;                  //¸ù¾Ý¹æ¶¨£¬RSºÍR/WÍ¬Ê±ÎªµÍµçÆ½Ê±£¬¿ÉÒÔÐ´ÈëÖ¸Áî
  63   1               RW=0;   
  64   1               E=0;                   //EÖÃµÍµçÆ½(Ð´Ö¸ÁîÊ±£¬
  65   1                                   // ¾ÍÊÇÈÃE´Ó0µ½1·¢ÉúÕýÌø±ä£¬ËùÒÔÓ¦ÏÈÖÃ"0"
  66   1               _nop_();
  67   1               _nop_();             //¿Õ²Ù×÷Á½¸ö»úÆ÷ÖÜÆÚ£¬¸øÓ²¼þ·´Ó¦Ê±¼ä
  68   1               P1=dictate;            //½«Êý¾ÝËÍÈëP0¿Ú£¬¼´Ð´ÈëÖ¸Áî»òµØÖ·
  69   1               _nop_();
  70   1               _nop_();
  71   1               _nop_();
  72   1               _nop_();               //¿Õ²Ù×÷ËÄ¸ö»úÆ÷ÖÜÆÚ£¬¸øÓ²¼þ·´Ó¦Ê±¼ä
  73   1               E=1;                   //EÖÃ¸ßµçÆ½
  74   1               _nop_();
  75   1               _nop_();
  76   1               _nop_();
  77   1               _nop_();               //¿Õ²Ù×÷ËÄ¸ö»úÆ÷ÖÜÆÚ£¬¸øÓ²¼þ·´Ó¦Ê±¼ä
  78   1                E=0;                  //µ±EÓÉ¸ßµçÆ½Ìø±ä³ÉµÍµçÆ½Ê±£¬Òº¾§Ä£¿é¿ªÊ¼Ö´ÐÐÃüÁî
  79   1       }
  80          
  81          //Ö¸¶¨×Ö·ûÏÔÊ¾µÄÊµ¼ÊµØÖ·
  82           void WriteAddress(unsigned char x)
  83           {
  84   1           Write_com(x|0x80); //ÏÔÊ¾Î»ÖÃµÄÈ·¶¨·½·¨¹æ¶¨Îª"80H+µØÖ·Âëx" 
  85   1       }
  86          
  87          //½«Êý¾Ý(×Ö·ûµÄ±ê×¼ASCIIÂë)Ð´ÈëÒº¾§Ä£¿é y(Îª×Ö·û³£Á¿)
  88           void WriteData(unsigned char y)
  89           {
  90   1          while(BusyTest()==1);  
  91   1                RS=1;           //RSÎª¸ßµçÆ½£¬RWÎªµÍµçÆ½Ê±£¬¿ÉÒÔÐ´ÈëÊý¾Ý
  92   1                RW=0;
  93   1                E=0;            //EÖÃµÍµçÆ½(Ð´Ö¸ÁîÊ±£¬£¬
  94   1                             // ¾ÍÊÇÈÃE´Ó0µ½1·¢ÉúÕýÌø±ä£¬ËùÒÔÓ¦ÏÈÖÃ"0"
  95   1                P1=y;           //½«Êý¾ÝËÍÈëP0¿Ú£¬¼´½«Êý¾ÝÐ´ÈëÒº¾§Ä£¿é
  96   1                _nop_();
  97   1                _nop_();
  98   1                _nop_();
  99   1                _nop_();       //¿Õ²Ù×÷ËÄ¸ö»úÆ÷ÖÜÆÚ£¬¸øÓ²¼þ·´Ó¦Ê±¼ä
 100   1                E=1;          //EÖÃ¸ßµçÆ½
 101   1                _nop_();
 102   1                _nop_();
 103   1                _nop_();
 104   1                _nop_();        //¿Õ²Ù×÷ËÄ¸ö»úÆ÷ÖÜÆÚ£¬¸øÓ²¼þ·´Ó¦Ê±¼ä
 105   1                E=0;            //µ±EÓÉ¸ßµçÆ½Ìø±ä³ÉµÍµçÆ½Ê±£¬Òº¾§Ä£¿é¿ªÊ¼Ö´ÐÐÃüÁî
 106   1       }
 107          
 108          //¶ÔLCDµÄÏÔÊ¾Ä£Ê½½øÐÐ³õÊ¼»¯ÉèÖÃ
 109          void LcdInt()
 110          {
 111   1              delay(15);             //ÑÓÊ±15ms£¬Ê×´ÎÐ´Ö¸ÁîÊ±Ó¦¸øLCDÒ»¶Î½Ï³¤µÄ·´Ó¦Ê±¼ä
 112   1              Write_com(0x38);  //ÏÔÊ¾Ä£Ê½ÉèÖÃ£º16¡Á2ÏÔÊ¾£¬5¡Á7µãÕó£¬8Î»Êý¾Ý½Ó¿Ú
 113   1              delay(5);   //ÑÓÊ±5ms¡¡
 114   1      
 115   1              Write_com(0x0c);  //ÏÔÊ¾Ä£Ê½ÉèÖÃ£ºÏÔÊ¾¿ª£¬ÓÐ¹â±ê£¬¹â±êÉÁË¸
 116   1              delay(5);
 117   1              Write_com(0x06);  
C51 COMPILER V9.01   TEST8                                                                 12/06/2018 16:35:05 PAGE 3   

 118   1              delay(5);                                                                                         
 119   1              Write_com(0x01);  //ÇåÆÁÄ»Ö¸Áî£¬½«ÒÔÇ°µÄÏÔÊ¾ÄÚÈÝÇå³ý
 120   1              delay(5);
 121   1       }
 122          
 123          //³õÊ¼»¯
 124          void sysinit()
 125          {
 126   1              LcdInt(); //³õÊ¼»¯ÆÁÄ»
 127   1              delay(5);
 128   1              TMOD = 0x21; //Éè¶¨¶¨Ê±Æ÷T1¹¤×÷·½Ê½  T0 ¹¤×÷·½Ê½1
 129   1              TH1=0xfd; //ÀûÓÃT1ÖÐ¶Ï²úÉúCLKÐÅºÅ
 130   1              TL1=0xfd;//50khz
 131   1              EA = 1; //¿ª×ÜÖÐ¶Ï  
 132   1              ET1=1;
 133   1              TR1=1; //Æô¶¯¶¨Ê±Æ÷T1
 134   1              TH0=0x45;
 135   1              TL0=0x00;//50MS¶¨Ê±
 136   1              ET0=1;
 137   1              TR0=1;
 138   1              start=0;    // START£º A£¯D×ª»»Æô¶¯ÐÅºÅ£¬ÊäÈë£¬¸ßµçÆ½ÓÐÐ§¡£
 139   1              oe=0;   //Êý¾ÝÊä³öÔÊÐíÐÅºÅ£¬ÊäÈë£¬¸ßµçÆ½ÓÐÐ§¡£µ±A£¯D×ª»»½áÊøÊ±£¬´Ë¶ËÊäÈëÒ»¸ö¸ßµçÆ½£¬²ÅÄÜ´ò¿ªÊä³öÈýÌ¬ÃÅ£¬Ê
             -ä³öÊý×ÖÁ¿¡£
 140   1      }
 141          
 142          //T0ÖÐ¶Ï·þÎñ³ÌÐò
 143          void t0() interrupt 1
 144          {
 145   1              ET0=0;
 146   1              TH0=0X45;//46
 147   1              TL0=0X00;//50MS¶¨Ê±
 148   1              n++;
 149   1              if(n==20) {flag=1;n=0;}
 150   1              ET0=1;
 151   1      }
 152          
 153          void t1() interrupt 3
 154          {
 155   1              ET1=0;
 156   1              CLK=~CLK;
 157   1              ET1=1;
 158   1      }
 159          
 160          //0808Êý¾Ý²É¼¯, ·µ»Ø²É¼¯Êý¾Ý
 161          unsigned char adc()
 162          {
 163   1         unsigned  char  Temp;
 164   1         start=1;
 165   1      //      delay(1);
 166   1              start=0;  //Æô¶¯ÐÅºÅ
 167   1         while (!eoc);// A£¯D×ª»»½áÊøÐÅºÅ
 168   1              P0=0xff;
 169   1      //      delay(1);
 170   1         oe=1;
 171   1         Temp=P0;//¶ÁÈ¡²É¼¯Êý¾Ý
 172   1         oe=0;
 173   1      //  delay(4);
 174   1         return(Temp);//·µ»Ø²É¼¯Êý¾Ý
 175   1      }
 176          
 177          //ÏÔÊ¾×Óº¯Êý
 178          void display(uint a)
C51 COMPILER V9.01   TEST8                                                                 12/06/2018 16:35:05 PAGE 4   

 179          {
 180   1              uint bai,shi,ge;
 181   1              bai=a/100;
 182   1              shi=(a-bai*100)/10;
 183   1              ge=a%10;
 184   1              WriteAddress(2);
 185   1              WriteData(0x30+bai);//ÏÔÊ¾°ÙÎ»
 186   1              WriteData(0x30+shi);//ÏÔÊ¾Ê®Î»
 187   1              WriteData(0x30+ge);//ÏÔÊ¾¸öÎ»
 188   1              
 189   1      }
 190          
 191          //Mainº¯Êý
 192          void main()
 193          {
 194   1              uint temp1,temp2;
 195   1              uchar f=0;
 196   1              sysinit();
 197   1              CLK=0;
 198   1              WriteAddress(0);//´ÓµÚ0ÐÐ¿ªÊ¼ÏÔÊ¾
 199   1              WriteData('f');//ÏÔÊ¾ f
 200   1              WriteData(':');//ÏÔÊ¾ £º
 201   1              WriteAddress(5);//´ÓµÚ5ÐÐ¿ªÊ¼ÏÔÊ¾
 202   1              WriteData('H'); //ÏÔÊ¾H
 203   1              WriteData('z');//ÏÔÊ¾z
 204   1              while(1)
 205   1              {               
 206   2                      temp2=temp1;
 207   2                      temp1=adc();//ad²É¼¯
 208   2                      if(((temp1>=128)&&(temp2<=128))||((temp1<=128)&&(temp2>=128)))
 209   2                      {
 210   3                              f++;//
 211   3                              out_pulse=1;
 212   3                              _nop_();
 213   3                              _nop_();
 214   3                              _nop_();
 215   3                              _nop_();
 216   3                              _nop_();
 217   3                              out_pulse=0;//²úÉú5usµÄÂö³åÐÅºÅ
 218   3                      }
 219   2                      if(flag==1)//µ½´ï1sºó¼ÆËãÆµÂÊ
 220   2                      {
 221   3                              flag=0;
 222   3                              f=f/2;
 223   3                              display(f);//ÏÔÊ¾ÆµÂÊ
 224   3                              f=0;
 225   3                      }
 226   2                      
 227   2              }
 228   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    457    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
